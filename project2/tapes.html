<!DOCTYPE html>
<html> 
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>COLLECTION</title>
    <link rel="icon" type="image/png" href="icon.png"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alice&family=Azeret+Mono:ital,wght@0,100..900;1,100..900&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Micro+5&family=Pangolin&family=Reenie+Beanie&family=Rethink+Sans:ital,wght@0,400..800;1,400..800&family=Schoolbell&family=Silkscreen:wght@400;700&family=Single+Day&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alice&family=Azeret+Mono:ital,wght@0,100..900;1,100..900&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Micro+5&family=Pangolin&family=Reenie+Beanie&family=Rethink+Sans:ital,wght@0,400..800;1,400..800&family=Schoolbell&family=Silkscreen:wght@400;700&family=Single+Day&family=VT323&display=swap" rel="stylesheet">
    <style>
        @media only screen and (min-width: 1000px) {
            .landscape {
              display: none;
            }
            body {
              background-color: rgb(0, 0, 0);
            }
            .flip {
              display: none;
            }
            .icon {
              display: none;
            }
            .iconcontainer {
              display: none;
            }
            .casette {
              display: none;
            }
        }

        @media only screen and (orientation: landscape) {
            * {
              box-sizing: border-box;
              margin: 0;
              padding: 0;
            }
            body {
              background: rgb(0, 0, 0);
            }
            .visuallyhidden {
              position: absolute;
              z-index: -1;
              right: 0;
              opacity: 0;
            }
            .container {
              overflow: hidden;
              padding: 20px;
            }
            .card-carousel {
              --card-width: 80%;
              --card-max-width: 280px;
              --card-height: 350px;
              --carousel-min-width: 600px;
              z-index: 1;
              position: relative;
              margin: 0 auto;
              width: 100%;
              height: var(--card-height);
              min-width: var(--carousel-min-width);
              transition: filter .3s ease;
            }
            @media screen and (max-width: 640px) {
                .card-carousel {
                  margin-left: calc((100vw - var(--carousel-min-width) - 40px) / 2)
                }
              }
              .card-carousel.smooth-return {
                transition: all .2s ease;
              }
              .card-carousel .card {
                width: var(--card-width);
                max-width: var(--card-max-width);
                text-align: center;
                padding: 1em;
                min-width: 250px;
                height: var(--card-height);
                position: absolute;
                margin: 0 auto;
                transition: inherit;
                filter: brightness(.9);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
              }
              .card.highlight {
                filter: brightness(1)
              }
              .image-container {
                width: var(--card-width);
                max-width: var(--card-max-width);
                text-align: center;
                padding: 1em;
                min-width: 250px;
                height: var(--card-height);
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                position: relative;
                filter: brightness(.9);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
              }
              .image-container .front,
              .image-container .back {
                position: absolute;
                width: 85%;
                height: 100%;
                backface-visibility: hidden;
                transition: transform 0.5s;
                transform-origin: center center;
                background-size: cover;
              }
              .image-container .back {
                transform: rotateY(180deg);
              }
              .flipped .front {
                transform: rotateY(180deg);
              }
              .flipped .back {
                transform: rotateY(0deg);
              }
              .image-container::after {
                content: '';
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                bottom: -15px;
                width: 85%;
                height: 15px;
                background: rgba(0, 0, 0, 0.3);
                z-index: -99; 
              }
              .icon {
                display: none;
              }
              .iconcontainer {
                display: none;
              }
              .nextbutton {
                position: absolute;
                top: 50%;
                transform: translateY(-50%); 
                right: 10px; 
                border: none;
                background-color: black;
                width: 7.2vw;
                z-index: 1000;
                pointer-events: auto;
            }
              .nexticon {
                width: 8vw;
                height: auto;
                right: 15px;
              }
          }
          @media only screen and (orientation: portrait) {
              .landscape {
                display: none;
              }
              body {
                  background-color: rgb(0, 0, 0);
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  height: 100vh;
                  /* overflow: hidden; */
              }
              .flip {
                  text-align: center;
                  color: white;
                  font-size: 18pt;
                  font-family: "Reenie Beanie", cursive;
              }
              .icon {
                  width: 40%;
                  height: 40%;
              }
              .iconcontainer {
                  display: block;
                  text-align: center;
              }
              .casette {
                  display: none;
              }
              .nextbutton {
                display: none;
            }
              .nexticon {
                  display: none;
              }
            }

        </style>
        </head>

<body>
    <div class="container">
      <div class="landscape">
        <div class="card-carousel">
          <div class="card" id="1">
              <div class="image-container" onclick="flipImage(this)">
                <div class="front" style="background-image: url('band/f1.png');"></div>
                <div class="back" style="background-image: url('band/b1.png');"></div>
              </div>
          </div>
          <div class="card" id="2">
            <div class="image-container" onclick="flipImage(this)">
              <div class="front" style="background-image: url('band/f2.png');"></div>
              <div class="back" style="background-image: url('band/b2.png');"></div>
            </div>
          </div>
          <div class="card" id="3">
            <div class="image-container" onclick="flipImage(this)">
              <div class="front" style="background-image: url('band/f3.png');"></div>
              <div class="back" style="background-image: url('band/b3.png');"></div>
            </div>
          </div>  
        <div class="card" id="4">
          <div class="image-container" onclick="flipImage(this)">
            <div class="front" style="background-image: url('band/f4.png');"></div>
            <div class="back" style="background-image: url('band/b4.png');"></div>
          </div>
        </div>
        <div class="card" id="5">
          <div class="image-container" onclick="flipImage(this)">
            <div class="front" style="background-image: url('band/f5.png');"></div>
            <div class="back" style="background-image: url('band/b5.png');"></div>
          </div>
        </div>
        <div class="card" id="6">
            <div class="image-container" onclick="flipImage(this)">
              <div class="front" style="background-image: url('band/f6.png');"></div>
              <div class="back" style="background-image: url('band/b6.png');"></div>
            </div>
          </div>
          <div class="card" id="7">
            <div class="image-container" onclick="flipImage(this)">
              <div class="front" style="background-image: url('band/f7.png');"></div>
              <div class="back" style="background-image: url('band/b7.png');"></div>
            </div>
          </div>
      </div>
      <a href="#" class="visuallyhidden card-controller">Carousel controller</a>
      </div>
      <h2 class="flip">rotate phone to proceed</h2>
      <div class="iconcontainer">
          <img class="icon" src="band/rotateicon.png">
      </div>
    </div>
    <button class="nextbutton"><a href="pics2.html"><img class="nexticon" src="band/skip.jpg"></a></button>

  <script>
    function flipImage(element) {
      element.parentElement.classList.toggle('flipped');
    }
    const cardsContainer = document.querySelector(".card-carousel");
    const cardsController = document.querySelector(".card-carousel + .card-controller")

    class DraggingEvent {
      constructor(target = undefined) {
        this.target = target;
      }
  
    event(callback) {
      let handler;
      
      this.target.addEventListener("mousedown", e => {
        e.preventDefault()
        
        handler = callback(e)
        
        window.addEventListener("mousemove", handler)
        
        document.addEventListener("mouseleave", clearDraggingEvent)
        
        window.addEventListener("mouseup", clearDraggingEvent)
        
        function clearDraggingEvent() {
          window.removeEventListener("mousemove", handler)
          window.removeEventListener("mouseup", clearDraggingEvent)
        
          document.removeEventListener("mouseleave", clearDraggingEvent)
          
          handler(null)
        }
    })
    
    this.target.addEventListener("touchstart", e => {
      handler = callback(e)
      
      window.addEventListener("touchmove", handler)
      
      window.addEventListener("touchend", clearDraggingEvent)
      
      document.body.addEventListener("mouseleave", clearDraggingEvent)
      
      function clearDraggingEvent() {
        window.removeEventListener("touchmove", handler)
        window.removeEventListener("touchend", clearDraggingEvent)
        
        handler(null)
      }
    })
  }
  

  getDistance(callback) {
    function distanceInit(e1) {
      let startingX, startingY;
      
      if ("touches" in e1) {
        startingX = e1.touches[0].clientX
        startingY = e1.touches[0].clientY
      } else {
        startingX = e1.clientX
        startingY = e1.clientY
      }
      

      return function(e2) {
        if (e2 === null) {
          return callback(null)
        } else {
          
          if ("touches" in e2) {
            return callback({
              x: e2.touches[0].clientX - startingX,
              y: e2.touches[0].clientY - startingY
            })
          } else {
            return callback({
              x: e2.clientX - startingX,
              y: e2.clientY - startingY
            })
          }
        }
      }
    }
    
    this.event(distanceInit)
  }
}


class CardCarousel extends DraggingEvent {
  constructor(container, controller = undefined) {
    super(container)
    
    // DOM elements
    this.container = container
    this.controllerElement = controller
    this.cards = container.querySelectorAll(".card")
    
    // Carousel data
    this.centerIndex = (this.cards.length - 1) / 2;
    this.cardWidth = this.cards[0].offsetWidth / this.container.offsetWidth * 100
    this.xScale = {};
    
    // Resizing
    window.addEventListener("resize", this.updateCardWidth.bind(this))
    
    if (this.controllerElement) {
      this.controllerElement.addEventListener("keydown", this.controller.bind(this))      
    }

    
    // Initializers
    this.build()
    
    // Bind dragging event
    super.getDistance(this.moveCards.bind(this))
  }
  
  updateCardWidth() {
    this.cardWidth = this.cards[0].offsetWidth / this.container.offsetWidth * 100
    
    this.build()
  }
  
  build(fix = 0) {
    for (let i = 0; i < this.cards.length; i++) {
      const x = i - this.centerIndex;
      const scale = this.calcScale(x)
      const scale2 = this.calcScale2(x)
      const zIndex = -(Math.abs(i - this.centerIndex))
      
      const leftPos = this.calcPos(x, scale2)
     
      
      this.xScale[x] = this.cards[i]
      
      this.updateCards(this.cards[i], {
        x: x,
        scale: scale,
        leftPos: leftPos,
        zIndex: zIndex
      })
    }
  }
  
  
  controller(e) {
    const temp = {...this.xScale};
      
      if (e.keyCode === 39) {
        // Left arrow
        for (let x in this.xScale) {
          const newX = (parseInt(x) - 1 < -this.centerIndex) ? this.centerIndex : parseInt(x) - 1;

          temp[newX] = this.xScale[x]
        }
      }
      
      if (e.keyCode == 37) {
        // Right arrow
        for (let x in this.xScale) {
          const newX = (parseInt(x) + 1 > this.centerIndex) ? -this.centerIndex : parseInt(x) + 1;

          temp[newX] = this.xScale[x]
        }
      }
      
      this.xScale = temp;
      
      for (let x in temp) {
        const scale = this.calcScale(x),
              scale2 = this.calcScale2(x),
              leftPos = this.calcPos(x, scale2),
              zIndex = -Math.abs(x)

        this.updateCards(this.xScale[x], {
          x: x,
          scale: scale,
          leftPos: leftPos,
          zIndex: zIndex
        })
      }
  }
  
  calcPos(x, scale) {
    let formula;
    
    if (x < 0) {
      formula = (scale * 100 - this.cardWidth) / 2
      
      return formula

    } else if (x > 0) {
      formula = 100 - (scale * 100 + this.cardWidth) / 2
      
      return formula
    } else {
      formula = 100 - (scale * 100 + this.cardWidth) / 2
      
      return formula
    }
  }
  
  updateCards(card, data) {
    if (data.x || data.x == 0) {
      card.setAttribute("data-x", data.x)
    }
    
    if (data.scale || data.scale == 0) {
      card.style.transform = `scale(${data.scale})`

      if (data.scale == 0) {
        card.style.opacity = data.scale
      } else {
        card.style.opacity = 1;
      }
    }
   
    if (data.leftPos) {
      card.style.left = `${data.leftPos}%`        
    }
    
    if (data.zIndex || data.zIndex == 0) {
      if (data.zIndex == 0) {
        card.classList.add("highlight")
      } else {
        card.classList.remove("highlight")
      }
      
      card.style.zIndex = data.zIndex  
    }
  }
  
  calcScale2(x) {
    let formula;
   
    if (x <= 0) {
      formula = 1 - -1 / 5 * x
      
      return formula
    } else if (x > 0) {
      formula = 1 - 1 / 5 * x
      
      return formula
    }
  }
  
  calcScale(x) {
    const formula = 1 - 1 / 5 * Math.pow(x, 2)
    
    if (formula <= 0) {
      return 0 
    } else {
      return formula      
    }
  }
  
  checkOrdering(card, x, xDist) {    
    const original = parseInt(card.dataset.x)
    const rounded = Math.round(xDist)
    let newX = x
    
    if (x !== x + rounded) {
      if (x + rounded > original) {
        if (x + rounded > this.centerIndex) {
          
          newX = ((x + rounded - 1) - this.centerIndex) - rounded + -this.centerIndex
        }
      } else if (x + rounded < original) {
        if (x + rounded < -this.centerIndex) {
          
          newX = ((x + rounded + 1) + this.centerIndex) - rounded + this.centerIndex
        }
      }
      
      this.xScale[newX + rounded] = card;
    }
    
    const temp = -Math.abs(newX + rounded)
    
    this.updateCards(card, {zIndex: temp})

    return newX;
  }
  
  moveCards(data) {
    let xDist;
    
    if (data != null) {
      this.container.classList.remove("smooth-return")
      xDist = data.x / 250;
    } else {

      
      this.container.classList.add("smooth-return")
      xDist = 0;

      for (let x in this.xScale) {
        this.updateCards(this.xScale[x], {
          x: x,
          zIndex: Math.abs(Math.abs(x) - this.centerIndex)
        })
      }
    }

    for (let i = 0; i < this.cards.length; i++) {
      const x = this.checkOrdering(this.cards[i], parseInt(this.cards[i].dataset.x), xDist),
            scale = this.calcScale(x + xDist),
            scale2 = this.calcScale2(x + xDist),
            leftPos = this.calcPos(x + xDist, scale2)
      
      
      this.updateCards(this.cards[i], {
        scale: scale,
        leftPos: leftPos
      })
    }
  }
}

const carousel = new CardCarousel(cardsContainer)

//swipe to next/previous page
console.log("JS RUNNING");

// document.addEventListener("touchstart", handleTouchStart, false);
// document.addEventListener("touchmove", handleTouchMove, false);

var xDown = null;
var yDown = null;

function getTouches(evt) {
    return (
        evt.touches || // browser API
        evt.originalEvent.touches
    ); // jQuery
}

function handleTouchStart(evt) {
    const firstTouch = getTouches(evt)[0];
    xDown = firstTouch.clientX;
    yDown = firstTouch.clientY;
}

function handleTouchMove(evt) {
    if (!xDown || !yDown) {
        return;
    }

    var xUp = evt.touches[0].clientX;
    var yUp = evt.touches[0].clientY;

    var xDiff = xDown - xUp;
    var yDiff = yDown - yUp;

    if (Math.abs(xDiff) > Math.abs(yDiff)) {
        /*most significant*/
        if (xDiff > 0) {
            // Swipe left action
        } else {
            // Swipe right action
        }
    } else {
        if (Math.abs(yDiff) > 10) { // Ensure the vertical swipe exceeds a certain threshold
            if (yDiff > 0) {
                /* up swipe */
                window.location.href = "pics2.html";
            } else {
                window.location.href = "casette.html";
            }
        }
    }
    xDown = null;
    yDown = null;
}
      function enableSwipeNavigation() {
          document.addEventListener("touchstart", handleTouchStart, false);
          document.addEventListener("touchmove", handleTouchMove, false);
      }
      window.addEventListener('load', function() {
      // Set a delay before enabling swipe navigation
          setTimeout(enableSwipeNavigation, 1000); // Adjust the delay time as needed (in milliseconds)
      });
  </script>
  </body>
  </html>